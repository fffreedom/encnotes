# iCloudåŒæ­¥åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

encnotesç°åœ¨æ”¯æŒ**çœŸæ­£çš„iCloudåŒæ­¥**åŠŸèƒ½ï¼Œä½¿ç”¨Appleçš„CloudKitæ¡†æ¶å®ç°è·¨è®¾å¤‡ç¬”è®°åŒæ­¥ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âœ… **çœŸæ­£çš„äº‘åŒæ­¥** - ä½¿ç”¨Apple CloudKitï¼Œæ•°æ®å­˜å‚¨åœ¨iCloud
- âœ… **å¢é‡åŒæ­¥** - åªåŒæ­¥ä¿®æ”¹è¿‡çš„ç¬”è®°ï¼ŒèŠ‚çœæµé‡
- âœ… **å†²çªè§£å†³** - è‡ªåŠ¨å¤„ç†å¤šè®¾å¤‡ç¼–è¾‘å†²çªï¼ˆæœ€åä¿®æ”¹ä¼˜å…ˆï¼‰
- âœ… **ç«¯åˆ°ç«¯åŠ å¯†** - ç¬”è®°å†…å®¹åŠ å¯†åä¸Šä¼ åˆ°äº‘ç«¯
- âœ… **è‡ªåŠ¨é™çº§** - å¦‚æœCloudKitä¸å¯ç”¨ï¼Œè‡ªåŠ¨ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿå®ç°
- âœ… **åå°åŒæ­¥** - æ”¯æŒè‡ªåŠ¨å®šæ—¶åŒæ­¥

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

è¿è¡Œå®‰è£…è„šæœ¬ï¼š

```bash
cd /Users/freedom/project/nb/encnotes
./install_cloudkit.sh
```

æˆ–æ‰‹åŠ¨å®‰è£…ï¼š

```bash
pip3 install pyobjc-framework-CloudKit
```

### 2. ç¡®ä¿iCloudå·²ç™»å½•

1. æ‰“å¼€ **ç³»ç»Ÿè®¾ç½®**
2. ç‚¹å‡»ä½ çš„ **Apple ID**
3. ç¡®ä¿ **iCloud** å·²å¯ç”¨
4. ç¡®ä¿ **iCloud Drive** å·²å¼€å¯

### 3. å¯ç”¨åŒæ­¥

1. æ‰“å¼€encnotesåº”ç”¨
2. ç‚¹å‡»èœå• **æ–‡ä»¶ -> å¯ç”¨iCloudåŒæ­¥**
3. ç­‰å¾…è´¦æˆ·çŠ¶æ€æ£€æŸ¥å®Œæˆ
4. çœ‹åˆ°"iCloudåŒæ­¥å·²å¯ç”¨"æç¤ºå³æˆåŠŸ

### 4. å¼€å§‹åŒæ­¥

- **æ‰‹åŠ¨åŒæ­¥**ï¼šç‚¹å‡» **æ–‡ä»¶ -> ç«‹å³åŒæ­¥**
- **æ‹‰å–ç¬”è®°**ï¼šç‚¹å‡» **æ–‡ä»¶ -> ä»iCloudæ‹‰å–**
- **è‡ªåŠ¨åŒæ­¥**ï¼šåº”ç”¨ä¼šæ¯5åˆ†é’Ÿè‡ªåŠ¨åŒæ­¥ä¸€æ¬¡

## ğŸ“± å¤šè®¾å¤‡ä½¿ç”¨

### åœ¨ç¬¬ä¸€å°è®¾å¤‡ä¸Š

1. åˆ›å»ºä¸€äº›ç¬”è®°
2. å¯ç”¨iCloudåŒæ­¥
3. ç‚¹å‡»"ç«‹å³åŒæ­¥"ä¸Šä¼ ç¬”è®°

### åœ¨ç¬¬äºŒå°è®¾å¤‡ä¸Š

1. ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„Apple IDç™»å½•iCloud
2. å®‰è£…å¹¶æ‰“å¼€encnotes
3. å¯ç”¨iCloudåŒæ­¥
4. ç‚¹å‡»"ä»iCloudæ‹‰å–"ä¸‹è½½ç¬”è®°

### æ—¥å¸¸ä½¿ç”¨

- åœ¨ä»»ä½•è®¾å¤‡ä¸Šç¼–è¾‘ç¬”è®°
- åº”ç”¨ä¼šè‡ªåŠ¨åŒæ­¥åˆ°iCloud
- å…¶ä»–è®¾å¤‡ä¼šè‡ªåŠ¨æ‹‰å–æ›´æ–°

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### åŒæ­¥æœºåˆ¶

1. **å¢é‡åŒæ­¥**
   - åªä¸Šä¼ ä¿®æ”¹æ—¶é—´æ™šäºä¸Šæ¬¡åŒæ­¥çš„ç¬”è®°
   - å‡å°‘ç½‘ç»œæµé‡å’ŒåŒæ­¥æ—¶é—´

2. **å†²çªè§£å†³**
   - æ¯”è¾ƒæœ¬åœ°å’Œè¿œç¨‹çš„ä¿®æ”¹æ—¶é—´
   - ä¿ç•™æœ€æ–°çš„ç‰ˆæœ¬
   - ç­–ç•¥ï¼šæœ€åä¿®æ”¹ä¼˜å…ˆï¼ˆLast Write Winsï¼‰

3. **æ•°æ®ç»“æ„**
   - ä½¿ç”¨CloudKitçš„Recordç±»å‹å­˜å‚¨ç¬”è®°
   - æ¯æ¡ç¬”è®°åŒ…å«ï¼šæ ‡é¢˜ã€å†…å®¹ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ç­‰
   - æ”¯æŒæ–‡ä»¶å¤¹å’Œæ ‡ç­¾åŒæ­¥ï¼ˆæœªæ¥ç‰ˆæœ¬ï¼‰

### CloudKit Schema

```
Record Type: Note
Fields:
  - identifier (String)      # ç¬”è®°å”¯ä¸€ID
  - title (String)           # æ ‡é¢˜
  - content (String)         # å†…å®¹ï¼ˆåŠ å¯†ï¼‰
  - creationDate (Date)      # åˆ›å»ºæ—¶é—´
  - modificationDate (Date)  # ä¿®æ”¹æ—¶é—´
  - isFavorite (Int64)       # æ˜¯å¦æ”¶è—
  - isDeleted (Int64)        # æ˜¯å¦åˆ é™¤
  - folderID (String)        # æ‰€å±æ–‡ä»¶å¤¹
```

### å®‰å…¨æ€§

- ç¬”è®°å†…å®¹ä½¿ç”¨AES-256åŠ å¯†
- åŠ å¯†å¯†é’¥å­˜å‚¨åœ¨æœ¬åœ°Keychain
- äº‘ç«¯åªå­˜å‚¨åŠ å¯†åçš„æ•°æ®
- å³ä½¿iCloudè¢«æ”»ç ´ï¼Œæ•°æ®ä¹Ÿæ— æ³•è§£å¯†

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šæç¤º"CloudKitæ¡†æ¶ä¸å¯ç”¨"

**åŸå› **ï¼šæœªå®‰è£…PyObjC CloudKitæ¡†æ¶

**è§£å†³**ï¼š
```bash
pip3 install pyobjc-framework-CloudKit
```

### é—®é¢˜2ï¼šæç¤º"iCloudè´¦æˆ·ä¸å¯ç”¨"

**åŸå› **ï¼šæœªç™»å½•iCloudæˆ–iCloud Driveæœªå¯ç”¨

**è§£å†³**ï¼š
1. æ‰“å¼€ç³»ç»Ÿè®¾ç½®
2. ç™»å½•Apple ID
3. å¯ç”¨iCloud Drive

### é—®é¢˜3ï¼šåŒæ­¥å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- ç½‘ç»œè¿æ¥é—®é¢˜
- iCloudæœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨
- CloudKité…é¢å·²æ»¡

**è§£å†³**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¨åé‡è¯•
3. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### é—®é¢˜4ï¼šç¬”è®°æœªåŒæ­¥

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] æ˜¯å¦å¯ç”¨äº†åŒæ­¥ï¼Ÿ
- [ ] æ˜¯å¦ç‚¹å‡»äº†"ç«‹å³åŒæ­¥"ï¼Ÿ
- [ ] ç½‘ç»œæ˜¯å¦æ­£å¸¸ï¼Ÿ
- [ ] æ˜¯å¦åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„Apple IDï¼Ÿ

### é—®é¢˜5ï¼šä½¿ç”¨æ¨¡æ‹Ÿå®ç°

**ç°è±¡**ï¼šæç¤º"ä½¿ç”¨æ¨¡æ‹Ÿå®ç°"

**è¯´æ˜**ï¼š
- è¿™æ˜¯é™çº§æ¨¡å¼ï¼Œæ•°æ®åªä¿å­˜åœ¨æœ¬åœ°
- ä¸ä¼šçœŸæ­£åŒæ­¥åˆ°iCloud
- éœ€è¦å®‰è£…CloudKitæ¡†æ¶æ‰èƒ½å¯ç”¨çœŸæ­£çš„åŒæ­¥

## ğŸ“Š åŒæ­¥çŠ¶æ€æŸ¥çœ‹

åœ¨åº”ç”¨ä¸­å¯ä»¥æŸ¥çœ‹åŒæ­¥çŠ¶æ€ï¼š

```python
# è·å–åŒæ­¥çŠ¶æ€
status = sync_manager.get_sync_status()

print(f"åŒæ­¥å·²å¯ç”¨: {status['enabled']}")
print(f"åŒæ­¥æ–¹æ³•: {status['sync_method']}")
print(f"è´¦æˆ·çŠ¶æ€: {status['account_status_name']}")
print(f"ä¸Šæ¬¡åŒæ­¥: {status['last_sync_time']}")
```

## ğŸ”„ åŒæ­¥æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»º/ç¼–è¾‘  â”‚
â”‚    ç¬”è®°     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ‡è®°ä¸ºå·²   â”‚
â”‚    ä¿®æ”¹     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è‡ªåŠ¨åŒæ­¥   â”‚â”€â”€â”€â”€â–¶â”‚  æ¨é€åˆ°      â”‚
â”‚  (5åˆ†é’Ÿ)    â”‚     â”‚  CloudKit    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  iCloudå­˜å‚¨  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å…¶ä»–è®¾å¤‡    â”‚
                    â”‚  è‡ªåŠ¨æ‹‰å–    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ å¼€å‘è€…ä¿¡æ¯

### æ–‡ä»¶ç»“æ„

```
encnotes/
â”œâ”€â”€ cloudkit_native.py      # åŸç”ŸCloudKitå®ç°
â”œâ”€â”€ icloud_sync.py          # åŒæ­¥ç®¡ç†å™¨ï¼ˆé›†æˆå±‚ï¼‰
â”œâ”€â”€ note_manager.py         # ç¬”è®°æ•°æ®åº“ç®¡ç†
â”œâ”€â”€ install_cloudkit.sh     # ä¾èµ–å®‰è£…è„šæœ¬
â””â”€â”€ CLOUDKIT_USAGE.md       # æœ¬æ–‡æ¡£
```

### APIä½¿ç”¨ç¤ºä¾‹

```python
from icloud_sync import CloudKitSyncManager
from note_manager import NoteManager

# åˆå§‹åŒ–
note_manager = NoteManager()
sync_manager = CloudKitSyncManager(note_manager)

# å¯ç”¨åŒæ­¥
success, message = sync_manager.enable_sync()
print(message)

# åŒæ­¥ç¬”è®°
success, message = sync_manager.sync_notes()
print(message)

# æ‹‰å–ç¬”è®°
success, result = sync_manager.pull_notes()
if success:
    print(f"æ‹‰å–äº† {result['count']} æ¡ç¬”è®°")

# è·å–çŠ¶æ€
status = sync_manager.get_sync_status()
print(f"åŒæ­¥æ–¹æ³•: {status['sync_method']}")
```

## ğŸ¯ æœªæ¥è®¡åˆ’

- [ ] æ”¯æŒæ¨é€é€šçŸ¥ï¼ˆè¿œç¨‹æœ‰æ›´æ–°æ—¶è‡ªåŠ¨æ‹‰å–ï¼‰
- [ ] æ”¯æŒæ–‡ä»¶å¤¹å’Œæ ‡ç­¾åŒæ­¥
- [ ] æ”¯æŒé™„ä»¶åŒæ­¥
- [ ] ä¼˜åŒ–å†²çªè§£å†³ç­–ç•¥ï¼ˆä¸‰æ–¹åˆå¹¶ï¼‰
- [ ] æ”¯æŒåŒæ­¥å†å²è®°å½•æŸ¥çœ‹
- [ ] æ”¯æŒé€‰æ‹©æ€§åŒæ­¥ï¼ˆåªåŒæ­¥ç‰¹å®šæ–‡ä»¶å¤¹ï¼‰

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š`~/Library/Group Containers/group.com.encnotes/encnotes.log`
2. æ£€æŸ¥CloudKit Dashboardï¼šhttps://icloud.developer.apple.com/dashboard
3. æäº¤Issueåˆ°GitHubä»“åº“

## ğŸ“„ è®¸å¯è¯

æœ¬åŠŸèƒ½éµå¾ªé¡¹ç›®çš„æ•´ä½“è®¸å¯è¯ã€‚

---

**äº«å—è·¨è®¾å¤‡æ— ç¼ç¬”è®°ä½“éªŒï¼** ğŸ“â˜ï¸
